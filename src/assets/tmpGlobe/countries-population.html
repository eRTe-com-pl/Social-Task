<head>
    <style>
        body {
            margin: 0;
        }
    </style>

    <!-- <script src="//unpkg.com/globe.gl"></script> -->
    <script src="../../dist/globe.gl.js"></script>
</head>

<body>
    <div id="globeViz"></div>

    <script>
        const world = Globe()(document.getElementById("globeViz"))
            .globeImageUrl(
                "//unpkg.com/three-globe/example/img/earth-night.jpg"
            )
            .backgroundImageUrl(
                "//unpkg.com/three-globe/example/img/night-sky.png"
            )
            .pointOfView({ altitude: 4 }, 5000)
            .polygonCapColor((feat) => "rgba(255, 255, 0, .3)")
            .polygonSideColor(() => "rgba(50, 100, 100, 0.3)")
            .polygonLabel(
                ({ properties: d }) => `
          <b>${d.ADMIN} (${d.ISO_A2})</b> <br />
          Population: <i>${Math.round(+d.POP_EST / 1e4) / 1e2}M</i>
        `
            );

        // Auto-rotate
        world.controls().autoRotate = true;
        world.controls().autoRotateSpeed = 0.1;

        fetch("../datasets/ne_110m_admin_0_countries_work.geojson")
            .then((res) => res.json())
            .then((countries) => {
                world.polygonsData(
                    countries.features.filter(
                        (d) => d.properties.ISO_A2 !== "AQ"
                    )
                );

                setTimeout(
                    () =>
                        world
                            .polygonsTransitionDuration(4000)
                            .polygonAltitude((feat) =>
                                Math.max(
                                    0.1,
                                    Math.sqrt(+feat.properties.POP_EST) * 7e-5
                                )
                            ),
                    2000
                );
            });
    </script>
</body>